<script>
  import cardData from '$gameFiles/card-data.json';
  import { GameData } from '$gameData';
  import Card from '$components/Card.svelte';
  import Modal from '$lib/components/Modal.svelte';

  /** @type {import('$types').Card} */
  $: card = cardData[$GameData.currentCardId];

  let flipped = false;

  /** @type {import('$types').Option | null} */
  let displayedOption = null;

  const makeDecision = (optionId) => {
    // TODO: Handle invalid decision
    GameData.advanceGameState({ optionId });
  };
</script>

<Modal showModal={displayedOption}>
  <div class="implication-body" slot="body">
    <h2>{displayedOption?.description}</h2>
    <p>TODO: Autogenerated text based on updates</p>
    <p>{displayedOption?.implicationText}</p>
    <button on:click={() => makeDecision(displayedOption.id)} class="button">Select</button>
  </div>
</Modal>
{#if flipped}
  <h1>{card.category}</h1>
  <h2>{card.prompt || 'MISSING PROMPT? ðŸ¥²'}</h2>
  <ul>
    {#each card.options as option (option.id)}
      <li>
        <button class="button button3" on:click={() => (displayedOption = option)}>
          {option.description}
        </button>
      </li>
    {/each}
  </ul>
{:else}<Card {card} />{/if}

<button class="button button" on:click={() => (flipped = !flipped)}>Flip card</button>

<style>
  li {
    margin: 1rem 0;
  }

  .implication-body {
    display: flex;
    flex-direction: column;
    align-items: center;
  }
</style>
